# Proposal: 加入「詳細財務數據表」

## Metadata
- **Change ID**: `add-financial-table`
- **Created**: 2025-01-26
- **Status**: Proposed
- **Author**: Claude
- **Branch**: `feature/add-financial-table`

## Problem Statement

目前經營績效分析平台僅顯示營收、稅前淨利、淨利率三項基本指標，無法滿足使用者進行深入財務分析的需求。使用者需要更多財務比率與指標來評估公司經營狀況，包括：

- 獲利能力指標：淨利率、毛利率、ROA
- 流動性指標：流動比率、速動比率
- 機桿指標：負債淨值比
- 效率指標：應收帳款週轉率、存貨周轉率
- 成長指標：營收成長率、毛利成長率、稅前淨利成長率
- 費用控制指標：推銷費用占比、管理費用佔比、研發費用佔比

## Proposed Solution

在現有頁面的 `FinanceChart` 組件之後、`DataManagerTabs` 組件之前，新增一個「詳細財務數據表」組件，顯示 14 個財務指標的跨年度比較資料。

### UI Position

```
┌─────────────────────────────────────┐
│  CompanySelector                    │
├─────────────────────────────────────┤
│  StatCards                          │
├─────────────────────────────────────┤
│  InsightPanel                       │
├─────────────────────────────────────┤
│  FinanceChart                       │
├─────────────────────────────────────┤
│  📊 詳細財務數據表 (NEW)             │
├─────────────────────────────────────┤
│  DataManagerTabs                    │
└─────────────────────────────────────┘
```

### Table Columns (15 columns)

1. **年度** - 顯示年份
2. **淨利率(%)** - 稅前淨利 / 營業收入淨額
3. **毛利率(%)** - 營業毛利 / 營業收入淨額
4. **ROA(%)** - 本年度淨利 / ((資產 + 前一年度資產) / 2)
5. **流動比率(%)** - 流動資產 / 流動負債
6. **速動比率(%)** - (流動資產 - 存貨 - 預付款項) / 流動負債
7. **負債淨值比(%)** - 負債 / 權益
8. **應收帳款週轉率(次)** - 營業收入淨額 / ((今年和去年(應收票據 + 應收帳款 + 應收帳款-關係人淨額)/2)
9. **存貨周轉率(次)** - 營業成本 / ((存貨 + 去年度存貨)/2)
10. **營收成長率(%)** - 營業收入淨額 / 前一年度營業收入淨額 - 1
11. **毛利成長率(%)** - 營業毛利 / 前一年度營業毛利 - 1
12. **稅前淨利成長率(%)** - 稅前淨利 / 前一年度稅前淨利 - 1
13. **推銷費用占比(%)** - 推銷費用 / 營業收入淨額
14. **管理費用佔比(%)** - 管理費用 / 營業收入淨額
15. **研發費用佔比(%)** - 研究發展費用 / 營業收入淨額

### Data Source

- **損益表資料**：來自 Supabase `pl_income_basics` 表
- **資產負債表資料**：來自 Supabase `financial_basics` 表
- **單位轉換**：Supabase 資料為「千元」單位，需除以 1000 轉為「百萬元」以與現有圖表一致

## Impact

### Benefits
- 提供更全面的財務分析視角
- 一次檢視 14 項關鍵財務指標的跨年度趨勢
- 減少使用者需要切換多個資料來源的不便

### Risks
- 表格欄位較多，在手機版可能需要橫向捲動
- 部分指標計算需要前一年度資料，第一年可能無法顯示

## Dependencies

- 現有 Supabase 資料表 `pl_income_basics` 和 `financial_basics`
- 現有 API 端點需要擴充或新增

## Alternatives Considered

1. **使用圖表而非表格**：圖表更直觀但無法同時顯示 14 個指標
2. **分頁顯示**：將指標分類到不同頁面，但會犧牲一目瞭然的優點

## Success Criteria

1. 表格正確顯示所有 14 個指標
2. 數值計算正確，單位轉換無誤
3. 無資料時顯示「-」符號
4. 回應式設計，在小螢幕上可橫向捲動查看
5. 與現有設計風格一致

## Open Questions

無
