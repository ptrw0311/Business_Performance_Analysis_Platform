# Proposal: 加入 KPI 和圖表區塊

## Change ID
`add-kpi-and-charts`

## Summary
在現有的「淨利率區塊」和「詳細財務數據表」之間，新增一個 KPI 分析與圖表視覺化區塊。此區塊包含左側三個 KPI 卡片（綜合分析評論、正面指標、風險/關注指標）和右側六張趨勢圖表。

## Motivation
目前平台已有詳細財務數據表，但缺少視覺化的趨勢圖表和即時的 KPI 分析。使用者需要：
1. 快速了解公司的財務健康狀況（透過 KPI 卡片）
2. 以圖表方式查看各項指標的歷史趨勢
3. 一眼看出正面指標與風險指標

## Proposed Solution

### Layout 結構
```
┌─────────────────────────────────────────────────────────────────┐
│  [淨利率區塊 - 已存在]                                          │
├─────────────────────────────────────────────────────────────────┤
│  ┌───────────────┬─────────────────────────────────────────┐   │
│  │ KPI 區域      │         圖表區域 (3/4 寬度)              │   │
│  │ (1/4 寬度)    │                                         │   │
│  ├───────────────│  ┌─────────────┐  ┌─────────────┐      │   │
│  │ 1. 綜合分析   │  │ 圖表 A      │  │ 圖表 B      │      │   │
│  │    評論       │  │ 獲利能力    │  │ 償債結構    │      │   │
│  ├───────────────│  ├─────────────┤  ├─────────────┤      │   │
│  │ 2. 正面指標   │  │ 圖表 C      │  │ 圖表 D      │      │   │
│  │    (Positive) │  │ 經營效率    │  │ 存貨週轉    │      │   │
│  ├───────────────│  ├─────────────┤  ├─────────────┤      │   │
│  │ 3. 風險指標   │  │ 圖表 E      │  │ 圖表 F      │      │   │
│  │    (Concern)  │  │ 成長動能    │  │ 費用率趨勢  │      │   │
│  └───────────────┴──┴─────────────┘  ┴─────────────┘      │   │
├─────────────────────────────────────────────────────────────────┤
│  [詳細財務數據表 - 已存在]                                     │
└─────────────────────────────────────────────────────────────────┘
```

### 左側 KPI 區域 (1/4 寬度)

#### 1. 綜合分析評論 (EXECUTIVE SUMMARY)
- **目前保留空白**，未來將使用 LLM 產出財務分析摘要文字
- 卡片結構保留，內容區域顯示提示文字或留白

#### 2. 正面指標 (Positive)
- 根據「財務分析指標.xlsx > 財務比率說明」的判斷邏輯自動識別
- 列出表現良好的指標（如：淨利率>10%、流動比率>2、營收成長>10%等）
- 以綠色圖標或符號標示

#### 3. 風險/關注指標 (Concern)
- 根據「財務分析指標.xlsx > 財務比率說明」的判斷邏輯自動識別
- 列出需要關注的指標（如：淨利率<0%、流動比率<1、負債淨值比>200%等）
- 以紅色/橙色圖標或符號標示

### 右側圖表區域 (3/4 寬度)

6 張圖表，資料來源皆來自 `api/financial/basics` 已計算的指標：

| 圖表 | 標題 | 資料來源 | 圖表類型 |
|------|------|----------|----------|
| A | 獲利能力 (Profitability) | 淨利率、毛利率、ROA | 折線圖 |
| B | 償債結構 (Solvency) | 流動比率、速動比率、負債淨值比 | 折線圖 |
| C | 經營效率 (AR Efficiency) | 應收週轉 | 混合圖(長條+折線) |
| D | 存貨週轉 (Inventory) | 存貨周轉 | 混合圖(長條+折線) |
| E | 成長動能 (Growth) | 營收成長率、毛利成長率、稅前淨利成長率 | 折線圖 |
| F | 費用率趨勢 (Expense Trend) | 推銷費用占比、管理費用佔比、研發費用佔比 | 折線圖 |

## Affected Components

### New Components
- `KPIAnalysisPanel.jsx` - KPI 分析面板容器
  - `ExecutiveSummary.jsx` - 綜合分析評論
  - `PositiveIndicators.jsx` - 正面指標
  - `ConcernIndicators.jsx` - 風險/關注指標
- `FinancialChartsPanel.jsx` - 財務圖表面板
  - `ProfitabilityChart.jsx` - 獲利能力圖表
  - `SolvencyChart.jsx` - 償債結構圖表
  - `AREfficiencyChart.jsx` - 經營效率圖表
  - `InventoryChart.jsx` - 存貨週轉圖表
  - `GrowthChart.jsx` - 成長動能圖表
  - `ExpenseTrendChart.jsx` - 費用率趨勢圖表

### Modified Components
- `HomePage.jsx` - 插入新的 KPI 和圖表區塊

### New Styles
- 新增 CSS 用於 KPI 卡片樣式
- 新增 CSS 用於圖表網格佈局

## Dependencies
- 現有 API: `/api/financial/basics` (已存在，無需修改)
- 現有圖表庫: `@nivo/bar`, `@nivo/line` (已安裝)

## Success Criteria
1. KPI 區塊正確顯示在淨利率區塊和詳細財務數據表之間
2. 左側 KPI 區域佔 1/4 寬度，右側圖表區域佔 3/4 寬度
3. 6 張圖表以 2x3 網格排列
4. 圖表資料與詳細財務數據表的數值一致
5. KPI 分析文字根據實際財務數據動態生成

## Open Questions
1. KPI 分析文字的生成邏輯複雜度：是否需要簡化版或規則引擎？
2. 圖表的顏色配置：是否需要與現有圖表保持一致？
3. 響應式設計：在小螢幕上如何調整佈局？

## Timeline Estimate
- 設計與規劃: 1 小時
- 組件開發: 4-6 小時
- 樣式調整: 2 小時
- 測試與修正: 2 小時
- 總計: 約 8-10 小時
